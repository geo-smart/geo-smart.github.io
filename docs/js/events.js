"use strict";import{useCachedOrLoad}from"./firebase.js";import{addAnimationObserver,formatDate}from"./utils.js";export async function setUpToastContent(e){const t=await useCachedOrLoad("events");t.sort(((e,t)=>e.start-t.start));const n=t[0],a=calculateRemainingTime(n.end);if(!n||!a)return;const s=createToastElement(n);e.parentElement.insertBefore(s,e),e.parentElement.removeChild(e),setUpToastOnClick(s),s.classList.add("show")}function createToastElement(e){const t=document.createElement("a");t.classList.add("rich-text"),t.id="toast",t.href=e.link,t.target="_blank";const n=startsWithVowel(e.name)?"an "+e.name:"a "+e.name,a=calculateRemainingTime(e.start),s=calculateRemainingTime(e.end),i=a?"happening":"ending",o=a||s,r=o.time+" "+o.units;return t.innerHTML=`\n    <img src="assets/info-icon.svg"/>\n    <p>\n      There is <span class="event-name">${n}</span> ${i} in <span class="event-time">${r}</span>! \n      Click to learn more.\n    </p>\n  `,t}function setUpToastOnClick(e){e.addEventListener("click",(t=>{t.preventDefault(),e.classList.add("hide"),setTimeout((()=>{const t=e.getAttribute("href");window.open(t,"_blank")}),500)}))}export async function setUpPastEvents(e){const t=await useCachedOrLoad("events"),n=[];t.forEach((t=>{if(null!==calculateRemainingTime(t.end))return;const a=createPastEventElement(t);e.parentElement.insertBefore(a,null),n.push(a)})),addAnimationObserver(n)}function createPastEventElement(e){const t=document.createElement("a");t.classList.add("book-section","animated-item","pre-anim","blur-in-anim"),t.href=e.link,t.target="_blank";const n=startsWithVowel(e.name)?"An "+e.name:"A "+e.name,a=formatDate(e.start,!1),s=formatDate(e.end,!0);return t.innerHTML=`\n    <img class="book-icon" src="assets/logo_icon.svg" alt="" />\n    <div class="book-section-desc">\n      <div class="label cc-light">${e.title}</div>\n      <p>${n} which took place from ${a} to ${s}</p>\n    </div>\n  `,t}function startsWithVowel(e){return-1!=="aeiouAEIOU".indexOf(e[0])}function calculateRemainingTime(e){const{seconds:t,nanoseconds:n}=e,a=1e3*t+Math.floor(n/1e6),s=new Date(a),i=new Date,o=s.valueOf()-i.valueOf(),r=36e5,c=864e5,l=6048e5;if(o>=l){return{units:"weeks",time:Math.floor(o/l)}}if(o>=c){return{units:"days",time:Math.floor(o/c)}}if(o>=r){return{units:"hours",time:Math.floor(o/r)}}return null}