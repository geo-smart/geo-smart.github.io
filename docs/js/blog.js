"use strict";import{loadCollection,useCachedOrLoad}from"./firebase.js";import{addAnimationObserver,formatDate}from"./utils.js";!function(){window.addEventListener("load",(function(){useCachedOrLoad("posts").then((t=>{e=t,window.dispatchEvent(new Event("posts-loaded"))})),l(document.getElementById("blog-post-return"),n),addEventListener("popstate",(()=>{if("#refresh"===window.location.hash){document.getElementById("blog-loader").classList.remove("hidden"),document.querySelectorAll(".blog-post").forEach((t=>t.remove())),async function(){loadCollection("posts"),window.dispatchEvent(new Event("posts-loaded"))}(),history.pushState("",document.title,window.location.pathname+window.location.search),d(0,"smooth")}else window.location.hash?s():i()})),addEventListener("posts-loaded",o)}));var t=void 0,e=null;function o(){console.log("Populating with loaded posts...");document.getElementById("blog-loader").classList.add("hidden"),function(t){const e=document.querySelector(".blog-list-wrap"),o=document.getElementById("blog-post-item"),n=[];for(let i=0;i<t.length;i++){const d=o.cloneNode(!0);d.classList.add("blog-post"),d.classList.remove("hidden"),d.id="";l(d.querySelector(".blog-summary-wrap"),(()=>{window.location.hash=a(d,i)})),d.querySelector(".blog-item-title").innerHTML=t[i].title,d.querySelector(".blog-item-date").innerHTML=formatDate(t[i].date),d.querySelector(".blog-item-summary").innerHTML=t[i].blurb?t[i].blurb:t[i].body,e.appendChild(d),n.push(d)}addAnimationObserver(n)}(e),s()}function n(){i(),history.pushState("",document.title,window.location.pathname+window.location.search)}function i(){void 0!==t?(d(t,"smooth"),t=void 0):(t=window.scrollY,d(0,"smooth")),document.getElementById("blog-items-list").classList.toggle("hidden"),document.getElementById("blog-post").classList.toggle("hidden")}function d(t,e){e=e||"instant",setTimeout((()=>{window.scrollTo({top:t,behavior:e})}),1)}function l(t,e){t.addEventListener("click",e),t.addEventListener("keydown",(t=>{"Enter"===t.key&&e(t)}))}function s(){if(!e)return;const o=function(t){if(!/#article-[0-9]$/.test(t))return;const o=parseInt(t.replace(/\D/g,""));return e[o-1]}(window.location.hash);o&&(!function(t){i(),document.getElementById("blog-post-title").innerHTML=t.title,document.getElementById("blog-post-date").innerHTML=formatDate(t.date),document.getElementById("blog-post-body").innerHTML=t.body,document.getElementById("blog-post-link").href=t.link}(o),void 0===t&&(t=0))}function a(t,o){return`article-${(o=void 0!==o?o:e.findIndex((e=>{e.title,t.title,e.date,t.date,e.body,t.body,e.link,t.link})))+1}`}}();