import{initializeApp}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";import{getFirestore}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";import{collection,getDocs}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";!function(){window.addEventListener("load",(function(){d(document.getElementById("blog-post-return"),r),addEventListener("popstate",(()=>{if("#refresh"===window.location.hash){document.getElementById("blog-loader").classList.remove("hidden"),document.querySelectorAll(".blog-post").forEach((e=>e.remove())),i(),history.pushState("",document.title,window.location.pathname+window.location.search),c(0,"smooth")}else window.location.hash?m():l()})),e&&a();addEventListener("posts-loaded",a)}));var e=null,t=0;const o=initializeApp({apiKey:"AIzaSyDtv_mjLaZQImF4KoKy6s-moer6TtOVJiI",authDomain:"geosmart-uw.firebaseapp.com",projectId:"geosmart-uw",storageBucket:"geosmart-uw.appspot.com",messagingSenderId:"244030791746",appId:"1:244030791746:web:f6c34ef4b145ab7d1a8ddb",measurementId:"G-9L9TCCS7HD"}),n=localStorage.getItem("cachedPosts");if(n){e=JSON.parse(n),console.log(`Loaded ${e.length} cached posts.`);const t=localStorage.getItem("cachedTime");t&&(s=new Date(t),((new Date).getTime()-s.getTime())/36e5>1)&&localStorage.clear()}else i();var s;async function i(){console.log("Loading posts from server...");const t=getFirestore(o),n=await getDocs(collection(t,"posts")),s=[];n.forEach((e=>{s.push(e.data())})),s.reverse(),e=s,localStorage.setItem("cachedPosts",JSON.stringify(s)),localStorage.setItem("cachedTime",(new Date).toISOString()),window.dispatchEvent(new Event("posts-loaded")),console.log(`Loaded ${e.length} posts from server.`)}function a(){console.log("Populating with loaded posts...");document.getElementById("blog-loader").classList.add("hidden"),function(e){const t=document.querySelector(".blog-list-wrap"),o=document.getElementById("blog-post-item"),n=[];for(let s=0;s<e.length;s++){const i=o.cloneNode(!0);i.classList.add("blog-post"),i.classList.remove("hidden"),i.id="";d(i.querySelector(".blog-summary-wrap"),(()=>{window.location.hash=g(i,s)})),i.querySelector(".blog-item-title").innerHTML=e[s].title,i.querySelector(".blog-item-date").innerHTML=u(e[s].date),i.querySelector(".blog-item-summary").innerHTML=e[s].blurb?e[s].blurb:e[s].body,t.appendChild(i),n.push(i)}!function(e){const t=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&e.target.classList.remove("pre-anim")}))}),{root:null,rootMargin:"0px",threshold:.45});e.forEach((e=>t.observe(e)))}(n)}(e),m()}function r(){l(),history.pushState("",document.title,window.location.pathname+window.location.search)}function l(){t?(c(t,"smooth"),t=0):(t=window.scrollY,c(0)),document.getElementById("blog-items-list").classList.toggle("hidden"),document.getElementById("blog-post").classList.toggle("hidden")}function c(e,t){t=t||"instant",setTimeout((()=>{window.scrollTo({top:e,behavior:t})}),1)}function d(e,t){e.addEventListener("click",t),e.addEventListener("keydown",(function(e){"Enter"===e.key&&t(e)}))}function m(){if(!e)return;const t=function(t){if(!/#article-[0-9]$/.test(t))return;const o=parseInt(t.replace(/\D/g,""));return e[o-1]}(window.location.hash);t&&function(e){l(),document.getElementById("blog-post-title").innerHTML=e.title,document.getElementById("blog-post-date").innerHTML=u(e.date),document.getElementById("blog-post-body").innerHTML=e.body,document.getElementById("blog-post-link").href=e.link}(t)}function g(t,o){return`article-${(o=void 0!==o?o:e.findIndex((e=>{e.title,t.title,e.date,t.date,e.body,t.body,e.link,t.link})))+1}`}function u(e){const{seconds:t,nanoseconds:o}=e,n=1e3*t+Math.floor(o/1e6);return new Date(n).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}}();